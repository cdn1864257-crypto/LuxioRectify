Bonjour,

Je souhaite ajouter sur mon site e-commerce (luxiomarket.shop) un systÃ¨me automatique de suspension temporaire des comptes utilisateurs aprÃ¨s plusieurs commandes non payÃ©es, afin de dÃ©courager les comportements abusifs.

Voici les fonctionnalitÃ©s exactes Ã  implÃ©menter :


---

ğŸ§© 1. Principe gÃ©nÃ©ral

Lorsquâ€™un utilisateur crÃ©e plusieurs commandes mais ne les paie pas (statut â€œexpiredâ€ ou â€œcancelledâ€), son compte doit Ãªtre temporairement suspendu aprÃ¨s un certain seuil.

Le but est dâ€™empÃªcher les utilisateurs qui abusent du systÃ¨me de passer de nouvelles commandes sans jamais les payer.



---

âš™ï¸ 2. RÃ¨gle de suspension

Si un utilisateur atteint 3 commandes non payÃ©es sur une pÃ©riode glissante de 30 jours, son compte passe automatiquement au statut â€œsuspendedâ€.

Pendant la suspension :

Lâ€™utilisateur peut se connecter et consulter son historique, mais ne peut plus passer de nouvelle commande (le bouton â€œCommanderâ€ doit Ãªtre dÃ©sactivÃ©).

Le systÃ¨me doit afficher un message clair expliquant la raison de la suspension.


La suspension dure 7 jours Ã  partir de la date de dÃ©clenchement.

Une fois ce dÃ©lai Ã©coulÃ©, le compte redevient automatiquement â€œactifâ€.



---

ğŸ§± 3. ImplÃ©mentation cÃ´tÃ© backend

Modifications sur la base de donnÃ©es (MongoDB)

Ajouter dans la collection users les champs suivants :

status: "active" | "suspended" | "blocked",
suspendedUntil: Date | null,
unpaidHistory: [
  { orderId, createdAt, amount, status }
]


Logique automatique :

Ã€ chaque fois quâ€™une commande passe en statut expired ou cancelled :

1. Ajouter un enregistrement dans user.unpaidHistory.


2. Calculer le nombre de commandes non payÃ©es dans les 30 derniers jours.


3. Si ce nombre â‰¥ 3 â†’ appliquer la suspension :

user.status = "suspended";
user.suspendedUntil = Date.now() + 7*24*60*60*1000;




Protection cÃ´tÃ© API :

Dans la route de crÃ©ation de commande (/checkout ou Ã©quivalent), ajouter un contrÃ´le :

if (user.status === "suspended" && user.suspendedUntil > Date.now()) {
    return res.status(403).json({ error: "Votre compte est temporairement suspendu suite Ã  plusieurs commandes non payÃ©es. RÃ©activation automatique prÃ©vue le " + formatDate(user.suspendedUntil) });
}



---

ğŸ’» 4. CÃ´tÃ© front-end / tableau de bord utilisateur

Lorsquâ€™un utilisateur suspendu se connecte :

Afficher une banniÃ¨re visible en haut du dashboard :

âš ï¸ Votre compte est temporairement suspendu suite Ã  plusieurs commandes non payÃ©es.
RÃ©activation automatique prÃ©vue le [date]. 
Vous pouvez consulter vos anciennes commandes mais pas en crÃ©er de nouvelles.

Le bouton â€œCommanderâ€ ou â€œPayerâ€ doit Ãªtre grisÃ© et non cliquable.


Sâ€™il essaie quand mÃªme dâ€™accÃ©der au checkout (via URL), afficher une page indiquant :

> â€œVotre compte est temporairement suspendu. Vous pourrez Ã  nouveau commander aprÃ¨s le [date].â€





---

ğŸ§° 5. CÃ´tÃ© administrateur

Dans le dashboard admin :

Ajouter un filtre ou section â€œComptes suspendusâ€.

Pour chaque utilisateur suspendu, afficher :

Son email

Le nombre de commandes non payÃ©es

La date de fin de suspension


Ajouter un bouton â€œRÃ©activer maintenantâ€ pour permettre Ã  lâ€™admin de lever la suspension avant la date prÃ©vue.




---

ğŸ”” 6. Notifications

Lorsquâ€™un compte est suspendu :

Envoyer un email automatique indiquant :

> â€œVotre compte a Ã©tÃ© temporairement suspendu en raison de plusieurs commandes non payÃ©es. Vous pourrez Ã  nouveau commander aprÃ¨s le [date].â€




Lorsquâ€™un compte est rÃ©activÃ© automatiquement :

Envoyer un autre email :

> â€œVotre compte est dÃ©sormais rÃ©activÃ©. Vous pouvez Ã  nouveau effectuer des commandes sur Luxio Market.â€






---

ğŸ“œ 7. Objectif UX

Lâ€™objectif est que lâ€™utilisateur comprenne clairement pourquoi il ne peut plus commander, et quâ€™il soit automatiquement notifiÃ© du retour Ã  la normale.
Aucune suppression de compte nâ€™est prÃ©vue, seulement une suspension temporaire pour dÃ©courager les comportements malveillants.


---

Merci dâ€™implÃ©menter cette logique complÃ¨te (backend + front + notifications + admin).
Si possible, le systÃ¨me doit Ãªtre compatible avec la logique de commande existante (virement et OxaPay) sans conflit.

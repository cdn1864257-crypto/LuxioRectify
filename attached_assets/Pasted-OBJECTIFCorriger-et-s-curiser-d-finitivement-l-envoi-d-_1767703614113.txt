OBJECTIFCorriger et sécuriser définitivement l’envoi d’emails transactionnels en PRODUCTIONvia SMTP Zoho, en utilisant Nodemailer, sur un backend Node.js / TypeScriptdéployé sur Render.
CONTEXTE TECHNIQUE (À RESPECTER STRICTEMENT)- Backend : Node.js + TypeScript- Envoi email : Nodemailer (SMTP uniquement)- Fournisseur SMTP : Zoho Mail- Environnement : PRODUCTION (Render)- AUCUN service tiers (Mailersend, Sendgrid, Resend, etc.) ne doit rester actif- Le code EXISTE déjà, il faut l’AUDITER et le CORRIGER, pas tout réécrire
VARIABLES D’ENV DÉJÀ DÉPLOYÉES (NE PAS LES MODIFIER)SMTP_HOST=smtp.zoho.comSMTP_PORT=465SMTP_SECURE=trueSMTP_USER=support@luxiomarket.shopSMTP_PASS=********MAIL_FROM=support@luxiomarket.shopNODE_ENV=production
INSTRUCTIONS OBLIGATOIRES (NE PAS EN SAUTER UNE)
ÉTAPE 1 — AUDIT- Identifier le fichier EXACT responsable de la configuration Nodemailer  (ex: utils/email.ts, utils/mailer.ts, services/emailService.ts, etc.)- Vérifier que :  - le transport Nodemailer utilise BIEN smtp.zoho.com  - le port est BIEN 465  - secure est BIEN true  - auth.user = process.env.SMTP_USER  - auth.pass = process.env.SMTP_PASS
ÉTAPE 2 — CORRECTION SMTP (CRITIQUE)- Ajouter explicitement ces options au transport Nodemailer :  - connectionTimeout: 20000  - greetingTimeout: 20000  - socketTimeout: 20000  - tls.rejectUnauthorized = false- NE PAS utiliser STARTTLS- NE PAS utiliser le port 587- NE PAS utiliser de fallback automatique vers un autre provider
ÉTAPE 3 — VÉRIFICATION SMTP (OBLIGATOIRE)- Ajouter AVANT tout envoi d’email :  await transporter.verify()- Logger clairement :  "SMTP Zoho connection verified successfully"- Si verify() échoue :  - logger l’erreur  - interrompre l’envoi (ne pas continuer)
ÉTAPE 4 — ENVOI D’EMAIL- L’expéditeur (from) doit être :  "Luxio Market <support@luxiomarket.shop>"- Le destinataire (to) doit être l’email utilisateur- Le contenu peut rester IDENTIQUE- Aucun test email hardcodé- Aucun mode sandbox- Aucun mock
ÉTAPE 5 — NETTOYAGE- Supprimer ou désactiver complètement :  - MailerSend  - Sendgrid  - tout fallback SMTP externe- Il ne doit rester QU’UN SEUL chemin d’envoi email : SMTP Zoho
SORTIE ATTENDUE (OBLIGATOIRE)À la fin, tu dois fournir STRICTEMENT :1) Le NOM du fichier modifié2) Le CODE FINAL COMPLET du fichier (pas un diff)3) Une confirmation explicite :   "SMTP Zoho prêt pour la production sur Render"
INTERDICTIONS ABSOLUES- Ne PAS inventer de variables d’env- Ne PAS proposer d’alternative- Ne PAS expliquer la théorie- Ne PAS poser de questions- Ne PAS modifier le frontend- Ne PAS modifier la logique métier
EXÉCUTE CES INSTRUCTIONS EXACTEMENT.